<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Placement Tracker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Reused Styles */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        body {
            background-color: #f3f4f6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        /* Styles for animated elements (Floating Books, Flying Papers) */
        .animated-element {
            position: absolute;
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        
        @keyframes book-drift {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-30px) rotate(10deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }
        .floating-book {
            width: 50px;
            height: 70px;
            background-color: #a78bfa; 
            border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            animation: book-drift 5s ease-in-out infinite alternate;
            animation-delay: var(--delay);
            top: var(--top);
            left: var(--left);
            opacity: 0;
            transition: opacity 1s ease;
        }
        .floating-book.active { opacity: 0.8; }

        .flying-paper {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            animation: book-drift 8s ease-in-out infinite alternate; 
            top: var(--top);
            left: var(--left);
            opacity: 0;
            transition: opacity 1s ease;
        }
        .flying-paper.active { opacity: 0.7; }

        /* Ensure main content is above animations */
        main {
            position: relative;
            z-index: 10;
        }
        .form-card-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .form-card-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- 1. Navbar (Header) -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                    <span class="text-white font-bold text-xl">PT</span>
                </div>
                <h1 class="text-xl font-bold gradient-text">Placement Tracker</h1>
            </div>
            
            <ul class="flex space-x-8 items-center">
                <li><a href="/" class="text-gray-700 hover:text-blue-600 transition">Home</a></li>
                <li id="registerLink"><a href="register.html" class="bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition">Register</a></li>
            </ul>
        </div>
    </nav>

    <!-- 2. Main Login Content -->
    <main class="flex-grow flex items-center justify-center py-12 px-4 z-10">
        <div class="w-full max-w-sm">
            
            <!-- Title -->
            <div class="text-center mb-8">
                <h2 class="mt-4 text-3xl font-bold text-gray-800">Welcome <span class="gradient-text">Back</span></h2>
                <p class="text-gray-600">Sign in to access your placement dashboard.</p>
            </div>

            <!-- Form Card -->
            <div class="bg-white p-8 md:p-10 rounded-3xl shadow-2xl border border-purple-200 form-card-lift">
                <form id="loginForm" class="space-y-6">
                    
                    <!-- Email Address Field -->
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input id="email" name="email" type="email" autocomplete="email" required class="w-full p-3 border border-gray-300 rounded-xl placeholder-gray-400 focus:ring-purple-500 focus:border-purple-500 transition duration-150" placeholder="your.name@college.edu">
                    </div>

                    <!-- Password Field -->
                    <div>
                        <div class="flex justify-between items-center">
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                            <div class="text-sm">
                                <a href="#" class="font-medium text-blue-600 hover:text-blue-500">
                                    Forgot password?
                                </a>
                            </div>
                        </div>
                        <input id="password" name="password" type="password" autocomplete="current-password" required class="w-full p-3 border border-gray-300 rounded-xl placeholder-gray-400 focus:ring-purple-500 focus:border-purple-500 transition duration-150" placeholder="Enter your password">
                    </div>

                    <!-- Remember Me Checkbox (Optional) -->
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500">
                        <label for="remember-me" class="ml-2 block text-sm text-gray-600">
                            Remember me
                        </label>
                    </div>

                    <!-- Message Box for Feedback -->
                    <div id="messageBox" class="hidden p-3 rounded-lg text-sm font-medium" role="alert"></div>

                    <!-- Submit Button -->
                    <div>
                        <button type="submit" id="loginButton" class="w-full flex justify-center py-3 px-4 rounded-xl shadow-lg text-lg font-bold text-white bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition duration-300 transform hover:scale-[1.01]">
                            Log In
                        </button>
                    </div>
                </form>
            </div>

            <!-- Registration Link -->
            <p class="mt-8 text-center text-sm text-gray-600">
                New to Placement Tracker?
                <a href="register.html" class="font-bold gradient-text hover:underline">
                    Create an account
                </a>
            </p>

        </div>
    </main>

    <!-- Animated Elements Container -->
    <div id="animation-container">
        <!-- Floating Books (Reused) -->
        <div class="animated-element floating-book" style="--top: 15%; --left: 5%; --delay: 0s;"></div>
        <div class="animated-element floating-book" style="--top: 40%; --left: 85%; --delay: 2s;"></div>
        <div class="animated-element floating-book" style="--top: 70%; --left: 15%; --delay: 4s;"></div>
        
        <!-- Flying Papers (Reused) -->
        <div class="animated-element flying-paper" style="--top: 35%; --left: 10%; --delay: 1s; width: 40px; height: 50px;"></div>
        <div class="animated-element flying-paper" style="--top: 65%; --left: 75%; --delay: 3s; width: 40px; height: 50px;"></div>
    </div>

    <!-- 3. Footer -->
    <footer class="bg-gray-900 text-white py-6 mt-auto z-50">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-400 text-sm">&copy; 2025 Placement Tracker. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript for API communication and Animations -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('loginForm');
            const loginButton = document.getElementById('loginButton');
            const messageBox = document.getElementById('messageBox');

            // --- Utility Functions ---

            function showMessage(message, type = 'error') {
                messageBox.textContent = message;
                messageBox.className = 'p-3 rounded-lg text-sm font-medium';
                if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-700', 'border', 'border-green-300');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-700', 'border', 'border-red-300');
                } else {
                    messageBox.classList.add('bg-blue-100', 'text-blue-700', 'border', 'border-blue-300');
                }
                messageBox.classList.remove('hidden');
            }

            function hideMessage() {
                messageBox.classList.add('hidden');
            }

            // --- Form Submission Handler ---

            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                hideMessage();
                loginButton.disabled = true;
                loginButton.textContent = 'Authenticating...';
                loginButton.classList.add('opacity-70');

                const userData = {
                    email: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                };

                // The FastAPI login endpoint expects form data, so we send it as a JSON body 
                // in this case, as defined in our Python API route logic.
                try {
                    const response = await fetch('/users/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(userData)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        showMessage('Login successful! Redirecting to dashboard...', 'success');
                        
                        // Store token/user data locally (optional, but good practice)
                        // localStorage.setItem('userToken', result.token);
                        // localStorage.setItem('userAccountType', result.account_type);

                        // Redirect to the main dashboard page
                        setTimeout(() => {
                            window.location.href = 'dashboard.html'; 
                        }, 1500);

                    } else {
                        // Handle authentication failure (401 Unauthorized)
                        const detail = result.detail || 'Invalid email or password.';
                        showMessage(`Login failed: ${detail}`, 'error');
                    }

                } catch (error) {
                    console.error('Network or unexpected error:', error);
                    showMessage('Network error. Please try again.', 'error');
                } finally {
                    loginButton.disabled = false;
                    loginButton.textContent = 'Log In';
                    loginButton.classList.remove('opacity-70');
                }
            });

            // --- Animation Activation Logic (Reused) ---
            function handleScrollAnimations() {
                const windowHeight = window.innerHeight;
                const formElement = document.querySelector('main');
                if (!formElement) return;

                const formRect = formElement.getBoundingClientRect();
                const formVisible = formRect.top < windowHeight * 0.8 && formRect.bottom > windowHeight * 0.2;

                const floatingElements = document.querySelectorAll('.floating-book, .flying-paper');
                floatingElements.forEach(el => {
                    if (formVisible) { 
                        el.classList.add('active');
                    } else {
                        el.classList.remove('active');
                    }
                });
            }
            
            // Event Listeners
            window.addEventListener('scroll', handleScrollAnimations);
            handleScrollAnimations(); 
        });
    </script>
</body>
</html>
